import React from 'react';
import { withFormsy } from 'formsy-react';

class MySelect extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      touched: false
    };
  }

  changeValue = (event) => {
    this.props.setValue(event.currentTarget.value);
  };

  handleTouched() {
    this.setState({
      touched:true
    })
  };

  handleFocusOut = (event) => {
    if (!event.target.value) {
      this.handleTouched();
    }
  };

  render() {
    const className = this.props.className;
    const errorMessage = this.props.getErrorMessage();

    return (
      <div>
        <select
          onChange={this.changeValue}
          onBlur={this.handleFocusOut}
          name={this.props.name}
          value={this.props.getValue()}
          className={`${className} ${errorMessage || this.props.showRequired() && this.state.touched ? 'is-invalid': ''}`}
        >
          {this.props.children}
        </select>
        <div className="invalid-feedback"> { errorMessage || (this.props.showRequired() && this.state.touched ? 'This field is required':'')} </div>
      </div>
    );
  }
}

export default withFormsy(MySelect);